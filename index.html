<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bücherregal</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { background: #fffaf4; }
    .shelf { fill: #6b4c3b; }
    .book {
      stroke: #333;
      stroke-width: 1px;
      rx: 2;
      ry: 2;
    }
    .star {
      fill: gold;
    }
  </style>
</head>
<body>
  <svg id="bookshelf" width="900" height="600"></svg>
  <script type="module">
    import yaml from 'https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/+esm';

    const response = await fetch('books.yaml');
    const yamlText = await response.text();
    const data = yaml.load(yamlText).books;

    const svg = d3.select("#bookshelf");
    const shelfHeight = 100;
    const shelfPadding = 10;
    const bookSpacing = 5;
    const shelfCount = 5;

    // Draw shelves
    for (let i = 0; i < shelfCount; i++) {
      svg.append("rect")
        .attr("x", 0)
        .attr("y", i * shelfHeight)
        .attr("width", 900)
        .attr("height", 10)
        .attr("class", "shelf");
    }

    // Render books
    let xOffset = 10;
    let shelfIndex = 0;

    data.forEach((book, i) => {
      const height = 60 + (book.pages / 10); // Seitenzahl als Höhe
      const width = 20; // einheitlich

      if (xOffset + width > 880) {
        xOffset = 10;
        shelfIndex++;
      }

      const y = shelfIndex * shelfHeight + (shelfHeight - height - 10);

      const bookGroup = svg.append("g");

      bookGroup.append("rect")
        .attr("x", xOffset)
        .attr("y", y)
        .attr("width", width)
        .attr("height", height)
        .attr("fill", book.color)
        .attr("class", "book")
        .transition()
        .duration(800)
        .attr("y", y - 10)
        .transition()
        .duration(300)
        .attr("y", y);

      if (book.favorite) {
        bookGroup.append("text")
          .attr("x", xOffset + width / 2)
          .attr("y", y - 5)
          .attr("text-anchor", "middle")
          .attr("class", "star")
          .text("★");
      }

      xOffset += width + bookSpacing;
    });
  </script>
</body>
</html>
